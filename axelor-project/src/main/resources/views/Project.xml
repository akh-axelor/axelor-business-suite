<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

	
	<grid name="project-grid" title="Projects" model="com.axelor.apps.project.db.Project">
	<toolbar>
		<button name="project-planning" title="Project planning" onClick="project.planning" if="__config__.app.isApp('employee')" if-module="axelor-human-resource"/>
	</toolbar>
	<menubar>
		<menu title="Tools" icon="fa-wrench" showTitle="true">
				<item title="Gantt with user" action="action-project-open-popup-select-users"/>
				<item title="Gantt with project" action="action-project-open-popup-select-projects"/>
		</menu>
	</menubar>
		<hilite background="primary" if="isProject &amp;&amp; projectTypeSelect == 1"/>
		<hilite background="info" if="isProject &amp;&amp; projectTypeSelect == 2"/>
		<field name="code"/>
		<field name="name"/>
        <field name="parentProject"/>
		<field name="clientPartner"/>
		<field name="assignedTo"/>
		<field name="fromDate" />
		<field name="toDate" />
		<field name="dueDate" />
		<button name="openGantt" title="Gantt" icon="fa-tasks" onClick="action-project-open-gantt"/>
		<field name="isProject" hidden="true"/>
		<field name="projectTypeSelect" hidden="true"/>
	</grid>

	<grid name="folder-project-grid" title="Projects" model="com.axelor.apps.project.db.Project">
		<field name="fullName"/>
		<field name="company"/>
		<field name="clientPartner"/>
	</grid>

	<form name="project-form" title="Project"
		model="com.axelor.apps.project.db.Project" onLoad="action-project-on-load-group"
		onNew="action-project-group-on-new-project">
		<menubar>
			<menu title="Reports" showTitle="true" icon="fa-files-o">
				<item if-module="axelor-business-project" title="Planification and costs"
					action="save,action-project-method-print-planif-and-cost" />
				<item if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
					title="Reporting folder" showIf="isBusinessProject"
					action="save,action-project-method-print-project" />
			</menu>
			<menu title="Tools" showTitle="true" icon="fa-wrench">
				<item title="Gantt" showIf="isProject" action="action-project-open-gantt" />
				<item title="Book resource" showIf="isProject"
					action="save,action-project-book-resource" />
				<item if="__config__.app.isApp('business-project')" title="Generate quotation"
					showIf="isBusinessProject" action="action-project-method-generate-quotation" />
			</menu>
		</menubar>
		<panel>
			<panel colSpan="12">
				<field name="statusSelect" showTitle="false" readonly="true"
					colSpan="8" widget="NavSelect" />
				<field name="$viewerProjectTags" showTitle="false" colSpan="4"
					readonly="true">
					<viewer
						depends="isBusinessProject,isProject,projectTypeSelect,$toInvoiceCounter,id">
							<![CDATA[
								<h4 style="text-align: right;">
									<span class="label label-default" style="background-color: #FD6217; margin: 5px 0 !important; display: inline-table; line-height: initial; border-top-right-radius: 0; border-bottom-right-radius: 0; padding-right: 0.4em;" ng-show="record.isBusinessProject" x-translate>To Invoice</span><span class="label label-default" style="background-color: #FFAA00; margin: 5px 0 !important; display: inline-table; line-height: initial; border-top-left-radius: 0; border-bottom-left-radius: 0;" ng-show="record.isBusinessProject &amp;&amp; record.id">{{record.$toInvoiceCounter}}</span>
									<span class="label label-default" style="background-color: #86BC25; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isProject &amp;&amp; record.projectTypeSelect == 1" x-translate>Project</span>
									<span class="label label-default" style="background-color: #86BC25; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isProject &amp;&amp; record.projectTypeSelect == 2" x-translate>Project phase</span>
									<span class="label label-default" style="background-color: #2185D0; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isBusinessProject" x-translate>Business</span>
								</h4>
							]]>
						</viewer>
				</field>
			</panel>
			<panel colSpan="12">
				<field name="fullName" showTitle="false" colSpan="12"
					css="label-bold bold large">
					<editor x-show-titles="false">
						<field name="code" showTitle="false" colSpan="3"
							css="label-bold bold large" x-bind="{{code|unaccent|uppercase}}" />
						<field name="name" showTitle="false" colSpan="9"
							css="label-bold bold large" />
					</editor>
				</field>
			</panel>
		</panel>
		<panel>
			<panel colSpan="12">
				<field name="company" form-view="company-form" grid-view="company-grid"
					colSpan="3" />
				<field name="clientPartner" domain="self.isCustomer = true"
					requiredIf="isBusinessProject" form-view="partner-form" grid-view="partner-grid"
					colSpan="3" if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
					showIf="isBusinessProject" />
				<field name="currency" colSpan="3"
					if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
					showIf="isBusinessProject" />
				<field name="priceList" colSpan="3"
					if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
					showIf="isBusinessProject" />
				<field name="contactPartner" onSelect="action-attrs-domain-on-contact-partner"
					form-view="partner-form" grid-view="partner-grid" colSpan="6"
					if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
					showIf="isBusinessProject" />
			</panel>
			<field name="progress" showIf="isProject" widget="Progress"
				colSpan="12" onChange="action-attrs-project-compute-leadDelay">
				<editor>
					<field name="progress" showTitle="false" colSpan="3" />
				</editor>
			</field>
			<field name="description" colSpan="12" widget="html" />
		</panel>

		<panel-tabs>
			<panel title="Task Tree" showIf="isProject">
				<button name="addTask" title="New" colSpan="2"
					css="btn-custom text-left" icon="fa-plus" onClick="save,action-project-add-task" />
				<button name="allTask" title="All tasks" colSpan="2"
					css="btn-custom text-left" icon="fa-tasks"
					onClick="action-project-view-show-related-tasks" />
				<panel-dashlet title="Task Tree" colSpan="12"
					action="action-view-show-project-task-tree" />
			</panel>
			<panel title="Phases" showIf="isProject &amp;&amp; childProjectList.length > 0">
				<button name="addPhase" title="New" colSpan="2"
					css="btn-custom text-left" icon="fa-plus" onClick="save,action-project-view-phase-new" />
				<button name="allPhases" title="All phases" colSpan="2"
					css="btn-custom text-left" icon="fa-tasks" onClick="save,action-project-view-phase-all" />
				<button name="allPhaseTasks" title="All phase tasks" colSpan="2"
					css="btn-custom text-left" icon="fa-tasks"
					onClick="save,action-project-phase-view-show-phase-task" />
				<panel-dashlet title="Phases" colSpan="12"
					action="tree:project-phase-tree" />
			</panel>
			<panel title="Members">
				<field name="team" title="Team"
					readonlyIf="synchronize || extendsMembersFromParent" colSpan="6"
					canNew="false" canEdit="false" />
				<field name="synchronize" readonlyIf="extendsMembersFromParent"
					colSpan="2" widget="boolean-switch" />
				<field name="extendsMembersFromParent" hidden="true"
					showIf="projectTypeSelect == 2" colSpan="3" widget="boolean-switch" />
				<field name="membersUserSet" showTitle="false" colSpan="12"
					widget="TagSelect" canNew="false" form-view="user-form" grid-view="user-grid" />
				<button name="importMembers" title="Import all members"
					showIf="team != null" readonlyIf="extendsMembersFromParent" colSpan="3"
					onClick="action-project-method-import-members" />
			</panel>
			<panel if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
				name="invoicing" title="Invoicing" showIf="isBusinessProject">
				<panel colSpan="12">
					<field name="projInvTypeSelect" colSpan="3" />
					<field name="invoiced" showTitle="false"
						showIf="projInvTypeSelect == 2 || projInvTypeSelect == 3" colSpan="2">
						<viewer>
								<![CDATA[
									<h4>
										<span class="label label-important"  ng-show="!record.invoiced"  x-translate>Not invoiced</span>
										<span class="label label-success" ng-show="record.invoiced" x-translate>Invoiced</span>
									</h4>
								]]>
							</viewer>
					</field>
				</panel>
				<panel colSpan="12" showIf="projInvTypeSelect == 3">
					<field name="product" onChange="action-project-record-unit"
						requiredIf="projInvTypeSelect == 3 &amp;&amp; isBusinessProject" />
					<field name="price" onChange="action-project-record-compute-exTaxTotal"
						requiredIf="projInvTypeSelect == 3 &amp;&amp; isBusinessProject" />
					<field name="qty" onChange="action-project-record-compute-exTaxTotal"
						requiredIf="projInvTypeSelect == 3 &amp;&amp; isBusinessProject" />
					<field name="unit"
						requiredIf="projInvTypeSelect == 3 &amp;&amp; isBusinessProject" />
					<field name="exTaxTotal" readonly="true" />
				</panel>
				<panel-related colSpan="12" field="elementsToInvoiceList"
					form-view="elements-to-invoice-form" grid-view="elements-to-invoice-grid" />
			</panel>
			<panel title="Planning" name="planning" if="__config__.app.isApp('employee')" if-module="axelor-human-resource">
				<field name="projectPlanningTimeList" grid-view="project-planning-time-grid" form-view="project-planning-time-form" colSpan="12" onChange="action-planning-time-attr-update-planned-hours"/>
				<panel if="__config__.app.isApp('employee')" if-module="axelor-human-resource" name="humanResource" title=" " colSpan="12">
					<field name="imputable" widget="boolean-switch" colSpan="4"/>
					<field name="totalPlannedHrs" readonly="true" colSpan="2">
					<viewer><![CDATA[
                    	<span>{{record.totalPlannedHrs}} </span><span x-translate>hours</span>
        			]]></viewer>
					</field>
				</panel>
				<button name="addMultipleLines" title="Add multiple lines" onClick="save,action-project-planning-time-open" colSpan="3" hideIf="$popup()"/>
			</panel>
			<panel
				if="eval: __config__.app.isApp('business-project') &amp;&amp; (__config__.app.getApp('business-project').getShowPurchaseOrderLineRelatedToProject() || __config__.app.getApp('business-project').getShowSaleOrderLineRelatedToProject() || __config__.app.getApp('business-project').getShowExpenseLineRelatedToProject() || __config__.app.getApp('business-project').getShowProductionOrderRelatedToProject() &amp;&amp; __config__.app.isApp('production') &amp;&amp; __config__.app.getApp('production').getManageBusinessProduction())"
				title="Related elements" showIf="isBusinessProject">
				<field name="saleOrder" domain="self.clientPartner = :clientPartner"
					form-view="sale-order-form" grid-view="sale-order-grid" colSpan="3" />
				<button-group colSpan="12">
					<button name="showInvoicingProjects" title="Create invoicing project"
						showIf="$toInvoiceCounter > 0" css="btn-custom" icon="fa-file-text-o"
						onClick="save,action-project-view-show-invoicing-projects" />
					<button name="showPurchaseOrderLines" title="Show purchase orders"
						css="btn-custom" icon="fa-shopping-cart"
						onClick="action-project-view-show-purchase-order-lines" />
					<button name="showSaleOrderLines" title="Show sale orders"
						css="btn-custom" icon="fa-line-chart" onClick="action-project-view-show-sale-order-lines" />
					<button name="showExpenseLines" title="Show expenses" css="btn-custom"
						icon="fa-credit-card" onClick="action-project-view-show-expense-lines" />
					<button
						if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowPurchaseInvoiceLineRelatedToProject()"
						if-module="axelor-business-production" name="showPurchaseInvoiceLines"
						title="Show purchase invoices" css="btn-custom" icon="fa-file-text-o"
						onClick="action-project-view-show-purchase-invoice-lines" />
					<button
						if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowSaleInvoiceLineRelatedToProject()"
						if-module="axelor-business-production" name="showSaleInvoiceLines"
						title="Show sale invoices" css="btn-custom" icon="fa-file-text-o"
						onClick="action-project-view-show-sale-invoice-lines" />
					<button
						if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowProductionOrderRelatedToProject()"
						if-module="axelor-business-production" name="showProductionOrders"
						title="Show production orders" css="btn-custom" icon="fa-cogs"
						onClick="action-project-view-show-production-orders" />
				</button-group>
				<panel-related
					if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowPurchaseOrderLineRelatedToProject()"
					if-module="axelor-business-project" colSpan="12" field="purchaseOrderLineList"
					form-view="purchase-order-line-project-form" grid-view="purchase-order-line-project-grid"
					editable="true" canSelect="true" canNew="false" canEdit="true" />
				<panel-related
					if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowSaleOrderLineRelatedToProject()"
					if-module="axelor-business-project" colSpan="12" field="saleOrderLineList"
					form-view="sale-order-line-project-form" grid-view="sale-order-line-project-grid"
					editable="true" canSelect="true" canNew="false" canEdit="true" />
				<panel-related
					if="eval: __config__.app.isApp('business-project') &amp;&amp;  __config__.app.getApp('business-project').getShowExpenseLineRelatedToProject()"
					if-module="axelor-business-project" colSpan="12" field="expensesLineList"
					form-view="expense-line-project-form" grid-view="expense-line-project-grid"
					editable="true" canSelect="true" canNew="false" canEdit="true" />
				<panel
					if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowPurchaseInvoiceLineRelatedToProject()"
					if-module="axelor-business-production" colSpan="12">
					<panel-dashlet colSpan="12"
						action="action-project-dashlet-show-purchase-invoice-lines" />
					<field name="$purchaseInvoiceLine" title="Purchase invoice line"
						colSpan="8" widget="ManyToOne"
						onChange="action-project-attrs-ro-purchase-order-line-buttons"
						target="com.axelor.apps.account.db.InvoiceLine" domain="self.invoice.operationTypeSelect = 1" />
					<button name="addPurchaseInvoiceLine" title="Add" colSpan="2"
						css="btn-custom" icon="fa-plus"
						onClick="com.axelor.apps.businessproject.web.ProjectController:managePurchaseInvoiceLine" />
					<button name="remPurchaseInvoiceLine" title="Remove"
						readonly="true" colSpan="2" css="btn-custom" icon="fa-times"
						onClick="com.axelor.apps.businessproject.web.ProjectController:managePurchaseInvoiceLine" />
				</panel>
				<panel
					if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowSaleInvoiceLineRelatedToProject()"
					if-module="axelor-business-production" colSpan="12">
					<panel-dashlet colSpan="12"
						action="action-project-dashlet-show-sale-invoice-lines" />
					<field name="$saleInvoiceLine" title="Sale invoice line"
						colSpan="8" widget="ManyToOne"
						onChange="action-project-attrs-ro-sale-order-line-buttons" target="com.axelor.apps.account.db.InvoiceLine"
						domain="self.invoice.operationTypeSelect = 3" />
					<button name="addSaleInvoiceLine" title="Add" colSpan="2"
						css="btn-custom" icon="fa-plus"
						onClick="com.axelor.apps.businessproject.web.ProjectController:manageSaleInvoiceLine" />
					<button name="remSaleInvoiceLine" title="Remove" readonly="true"
						colSpan="2" css="btn-custom" icon="fa-times"
						onClick="com.axelor.apps.businessproject.web.ProjectController:manageSaleInvoiceLine" />
				</panel>
				<panel-related
					if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowProductionOrderRelatedToProject()"
					if-module="axelor-business-production" colSpan="12" field="productionOrderList"
					canSelect="true" canNew="false" canEdit="false" />
			</panel>

			<panel if="__config__.app.isApp('timesheet')" if-module="axelor-human-resource"
				name="logTimes" title="Log Times">
				<field name="totalPlannedHrs" if="__config__.app.isApp('employee')"
					if-module="axelor-human-resource" readonly="true" colSpan="3">
					<viewer>
		       <![CDATA[
		      <span>{{record.totalPlannedHrs}} </span><span x-translate>hours</span>
			]]>
		      </viewer>
				</field>
				<field name="timeSpent" title="Time Spent" readonly="true"
					colSpan="3" />
				<field name="leadDelay" title="Lead/Delay" readonly="true"
					showIf="isProject"
					onChange="action-project-method-set-stored-lead-delay,action-method-project-compute-progress"
					colSpan="3" />
				<panel-related colSpan="12" field="timesheetLineList"
					form-view="timesheet-line-project-form" grid-view="timesheet-line-project-grid" />
			</panel>
			<panel name="wiki" title="Wiki">
				<panel-related field="wikiList" colSpan="12" form-view="wiki-form" grid-view="wiki-grid-incl-project"/>
			</panel>

			<panel name="configurations" title="Configurations">
				<field if="__config__.app.isApp('employee')" if-module="axelor-human-resource"
					name="productSet" colSpan="12" widget="TagSelect" canEdit="false"
					domain="self.isActivity = true" form-view="product-activity-form"
					grid-view="product-activity-grid" />
				<field name="projectCategorySet" colSpan="12" widget="TagSelect" />
				<field name="projectFolderSet" colSpan="12" widget="TagSelect" />
				<field name="excludeTimesheetEditor" />
				<field name="childProjectList" hidden="true" />
				<button name="computeDurationFromChildren" title="Compute duration"
					showIf="childProjectList.length > 0" colSpan="3"
					onClick="save,action-method-project-compute-duration-fromchildren,save" />
				<field name="sequence" hidden="true" />
				<field name="excludePlanning" if-module="axelor-business-project"
					showIf="isProject" />
				<field name="imputable" colSpan="4" widget="boolean-switch"
					if="__config__.app.isApp('employee')" if-module="axelor-human-resource" />
			</panel>
		</panel-tabs>
		<panel>
			<field name="attrs" colSpan="12" hidden="true" />
		</panel>
		<panel hideIf="statusSelect == 4" colSpan="2" sidebar="true">
			<button name="start" title="Start" hidden="true" showIf="statusSelect == 1"
				colSpan="12" icon="fa-play" onClick="action-project-record-status-in-progress,save" />
			<button name="finish" title="Finish" hidden="true" showIf="statusSelect == 2"
				colSpan="12" icon="fa-check" onClick="action-project-record-status-finished,save" />
			<button name="cancel" title="Cancel" hidden="true"
				showIf="statusSelect == 2 || statusSelect == 3" colSpan="12" css="btn-danger"
				icon="fa-times-circle" onClick="action-project-record-status-canceled,save" />
		</panel>
		<panel name="caracteristics" title="Caracteristics" colSpan="12"
			sidebar="true" canCollapse="true">
			<panel colSpan="12">
				<field if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
					name="isProject" colSpan="6" widget="boolean-switch" />
				<field if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
					name="isBusinessProject" colSpan="6" widget="boolean-switch" />
				<field if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
					name="$toInvoiceCounter" showTitle="false" hidden="true" colSpan="6" />
			</panel>
			<panel if-module="axelor-business-project" name="project"
				showIf="isProject" colSpan="12">
				<field name="projectTypeSelect" onChange="action-project-record-empty-parent-project"
					requiredIf="isProject" />
				<field name="parentProject" showIf="projectTypeSelect == 2"
					domain="self.isProject = true AND self.projectTypeSelect = 1"
					requiredIf="projectTypeSelect == 2" />
			</panel>
		</panel>
		<panel colSpan="12" title="Follow-up" sidebar="true" canCollapse="true">
			<field name="assignedTo" title="Person In Charge" canNew="false"
				canView="false" canEdit="false" onChange="action-attrs-project-add-member"
				form-view="user-form" grid-view="user-grid" />
		</panel>
		<panel name="date" title="Dates" colSpan="12" sidebar="true"
			canCollapse="true">
			<field name="fromDate" colSpan="6" />
			<field name="toDate" colSpan="6" />
			<field name="dueDate" showIf="isProject" colSpan="6" />
			<field name="duration" title="Duration"
				onChange="action-attrs-project-compute-leadDelay" colSpan="6" />
		</panel>
		<panel-mail>
			<mail-messages limit="4" />
			<mail-followers />
		</panel-mail>
	</form>


	 <form name="project-select-wizard-form" title="Select Projects"   model="com.axelor.apps.base.db.Wizard">
		<panel>
			<field name="projectSet"  title="Projects"  type="many-to-many" colSpan="12" target="com.axelor.apps.project.db.Project" canNew="false"/>
			<button name="gantt" title="Open gantt" onClick="action-wizard-validate-project-select,action-open-project-gantt,close" colSpan="3" />
		</panel>
	</form>
	
	<form name="user-select-wizard-form" title="Select Users"  model="com.axelor.apps.base.db.Wizard">
		<panel>
			<field name="userSet" title="Users" type="many-to-many" colSpan="12" target="com.axelor.auth.db.User" canNew="false"/>
			<button name="gantt" title="Open gantt" onClick="action-wizard-validate-user-select,action-open-user-gantt,close" colSpan="3"  />
		</panel>
	</form>
	
	<kanban columnBy="statusSelect" sequenceBy="statusSelect" limit="10"
	 name="project-kanban" title="Projects" model="com.axelor.apps.project.db.Project">
		<field name="fullName"/>
		<field name="description"/>
		<field name="progress"/>
		<field name="dueDate"/>
		<field name="leadDelay"/>
		<field name="statusSelect"/>
		<field name="sequence"/>
		<hilite color="danger" if="dueDate.isAfter(__datetime__) &amp;&amp; statusSelect &lt; 3"/>
		<hilite color="success" if="(dueDate.isBefore(__datetime__) || dueDate.equals(__datetime__)) &amp;&amp; leadDelay &gt;= 0 &amp;&amp; statusSelect &lt; 3"/>
		<hilite color="warning" if="(dueDate.isBefore(__datetime__) || dueDate.equals(__datetime__)) &amp;&amp; leadDelay &lt; 0 &amp;&amp; statusSelect &lt; 3"/>
		<template>
		&lt;h4&gt;{{fullName}}&lt;/h4&gt;
		&lt;div class="card-body"&gt;{{description}}&lt;/div&gt;
		&lt;div class="card-footer"&gt;
		  &lt;i class='fa fa-clock-o'&gt;&lt;/i&gt; &lt;span&gt;{{dueDate|date:'dd/MM/yyyy'}}&lt;/span&gt;
		&lt;/div&gt;
		</template>
	</kanban>
	
	<kanban columnBy="statusSelect" sequenceBy="statusSelect" limit="10"
	 name="task-kanban" title="Tasks" model="com.axelor.apps.project.db.Project">
		<field name="fullName"/>
		<field name="description"/>
		<field name="progress"/>
		<field name="dueDate"/>
		<field name="leadDelay"/>
		<field name="statusSelect"/>
		<field name="sequence"/>
		<hilite color="danger" if="dueDate.isAfter(__datetime__) &amp;&amp; statusSelect &lt; 3"/>
		<hilite color="success" if="(dueDate.isBefore(__datetime__) || dueDate.equals(__datetime__)) &amp;&amp; leadDelay &gt;= 0 &amp;&amp; statusSelect &lt; 3"/>
		<hilite color="warning" if="(dueDate.isBefore(__datetime__) || dueDate.equals(__datetime__)) &amp;&amp; leadDelay &lt; 0 &amp;&amp; statusSelect &lt; 3"/>
		<template>
		&lt;h4&gt;{{fullName}}&lt;/h4&gt;
		&lt;div class="card-body"&gt;{{description}}&lt;/div&gt;
		&lt;div class="card-footer"&gt;
		  &lt;i class='fa fa-clock-o'&gt;&lt;/i&gt; &lt;span&gt;{{dueDate|date:'dd/MM/yyyy'}}&lt;/span&gt;
		&lt;/div&gt;
		</template>
	</kanban>
	
	<calendar name="project-calendar" 
			  model="com.axelor.apps.project.db.Project" 
			  title="Project Calendar"
			  eventStart="fromDate"
			  eventStop="toDate"
			  eventLength="1"
			  colorBy="statusSelect"
			  mode="month"
			  >
			  <field name="fullName"/>
	</calendar>
	
	<action-view name="action-view-show-project-task-tree" title="Project Task Tree" model="com.axelor.team.db.TeamTask">	
		<view type="tree" name="project-task-tree"/>
    	<view type="form" name="team-task-form"/>
    	<domain>self.project.id = :_id AND self.parentTask = null</domain>
     	<context name="_id" expr="eval: id"/>
	</action-view>
	


	<tree name="project-task-tree" title="Tasks">
    	
    	<column name="name" type="string"/>
			<column name="taskDate" type="date"/>
    	<column name="assignedTo" type="reference"/>
    	<column name="progress" type="integer"/>
		<column name="openTask" type="button"/>

		<node model="com.axelor.team.db.TeamTask" domain="self.project.id = :_id" onClick="action-team-task-view-task" orderBy="taskDate">
			<field name="name" as="name"/>
			<field name="taskDate" as="taskDate"/>
			<field name="assignedTo" as="assignedTo"/>
			<field name="progressSelect" as="progress"/>
			<button name="openTask" title="Open task" onClick="action-team-task-open-task"/>
		</node>

		<node model="com.axelor.team.db.TeamTask" parent="parentTask" draggable="true" onClick="action-team-task-view-task" orderBy="taskDate">
			<field name="name" as="name"/>
			<field name="taskDate" as="taskDate"/>
			<field name="assignedTo" as="assignedTo"/>
			<field name="progressSelect" as="progress"/>
			<button name="openTask" title="Open task" onClick="action-team-task-open-task"/>
		</node>
    
	</tree>
	
	<tree name="project-phase-tree" title="Phases">
    	
    	<column name="name" type="string"/>
    	<column name="assignedTo" type="reference"/>
    	<column name="progress" type="integer"/>
		<column name="openTask" type="button"/>

		<node model="com.axelor.apps.project.db.Project" domain="self.parentProject.id = :id" onClick="action-project-view-phase">
			<field name="name" as="name"/>
			<field name="assignedTo" as="assignedTo"/>
			<field name="progress" as="progress"/>
			<button name="openTask" title="Open phase" onClick="action-project-view-phase"/>
		</node>
		
		<node model="com.axelor.team.db.TeamTask" parent="project" draggable="true" onClick="action-team-task-view-task">
			<field name="name" as="name"/>
			<field name="assignedTo" as="assignedTo"/>
			<field name="progressSelect" as="progress"/>
			<button name="openTask" title="Open task" onClick="action-team-task-open-task"/>
		</node>
		
	</tree>
	
	<action-group name="action-project-group-on-new-project">
		<action name="action-project-defaults"/>
		<action name="action-project-attrs-scale-and-precision"/>
		<action name="action-attrs-project-set-project-type" if="__config__.app.isApp('business-project')" />
		<action name="action-project-record-init-type"/>
	</action-group>
	
	<action-group name="action-project-on-load-group">
		<action name="action-project-attrs-scale-and-precision" />
		<action name="action-attrs-project-set-project-type"  if="__config__.app.isApp('business-project')" />
		<action name="action-project-method-count-to-invoice" if="__config__.app.isApp('business-project')"/>
	</action-group>

	<action-record name="action-project-record-inv-type-select" model="com.axelor.apps.project.db.Project">
		<field name="projInvTypeSelect" expr="eval: project?.projInvTypeSelect"/>
	</action-record>
	
	<action-attrs name="action-project-attrs-hide-invoicing-panel">
		<attribute name="hidden" for="invoicingPanel" expr="eval: projInvTypeSelect != 3"/>
	</action-attrs>
	
	<action-attrs name="action-task-attrs-assigned-to-domain">
	    <attribute name="domain" for="assignedTo" expr="eval:&quot;self.id in (${(project?.membersUserSet?.collect{it->it.id}+[0,0]).join(',')}) &quot;"
				   if="(typeSelect == 'task')&amp;&amp;(project?.membersUserSet)&amp;&amp;(!project.membersUserSet.isEmpty())" />
	</action-attrs>
	
	<action-attrs name="action-project-defaults" model="com.axelor.apps.project.db.Project">
		<attribute name="value" for="fromDate" expr="eval: __datetime__"/>
		<attribute name="value" for="company" expr="eval:__user__.activeCompany"/>
		<attribute name="value" for="assignedTo" expr="eval: __user__"/>
		<attribute name="value:add" for="membersUserSet" expr="eval: __user__"/>
		<attribute name="value" for="isProject" expr="eval:_fromProject"/>
		<attribute name="value" for="isBusinessProject" expr="eval:_fromBusinessProject"/>
		<attribute name="value" for="parentProject" expr="eval:__repo__(Project).find(_parentProjectId)" if="_parentProjectId != null" />
	</action-attrs>

	<action-attrs name="action-attrs-project-add-member" model="com.axelor.apps.project.db.Project">
		<attribute name="value:add" for="membersUserSet" expr="eval: assignedTo"/>
	</action-attrs>
	
	<action-attrs name="action-attrs-project-set-project-type" model="com.axelor.apps.project.db.Project">
		<attribute name="readonly" for="isProject" expr="eval:_fromProject"/>
		<attribute name="readonly" for="isBusinessProject" expr="eval:_fromBusinessProject"/>
	</action-attrs>

	<action-record name="action-project-record-init-type" model="com.axelor.apps.project.db.Project">
		<field name="projectTypeSelect" expr="eval: _xProjectTypeSelect"/>
	</action-record>

	<action-record name="action-project-record-empty-parent-project" model="com.axelor.apps.project.db.Project">
		<field name="parentProject" expr="eval: null"/>
	</action-record>
	
	<action-view name="action-project-task-view" title="Tasks" model="com.axelor.team.db.TeamTask">
    	<view type="form" name="team-task-form"/>
        <view-param name="popup" value="reload"/>
        <view-param name="show-toolbar" value="false"/>
  		<view-param name="show-confirm" value="false" />
	  	<view-param name="popup-save" value="false"/>
    	<context name="_showRecord" expr="eval: id"/>
    </action-view>
    	
	<action-view name="action-project-view-show-project" title="Related Projects" model="com.axelor.apps.project.db.Project">
		<view type="grid" name="project-grid" />
		<view type="form" name="project-form" />
		<domain>self.typeSelect = 'project' AND self.project.id = :id</domain>
	</action-view>
	
	<action-view name="action-project-view-show-task" title="Tasks" model="com.axelor.apps.project.db.Project">
		<view type="grid" name="team-task-grid" />
		<view type="form" name="team-task-form" />
		<domain>self.typeSelect = 'task' AND self.project.id = :id</domain>
	</action-view>
	
	<action-view name="action-project-view-show-related-tasks" title="Related tasks" model="com.axelor.team.db.TeamTask">
		<view type="kanban" name="team-task-kanban"/>
		<view type="grid" name="team-task-grid"/>
		<view type="form" name="team-task-form"/>
		<domain>(self.project.id = :_id OR self.project.parentProject.id = :_id)</domain>
	</action-view>
	
	<action-view name="action-project-view-create-team" model="com.axelor.team.db.Team" title="Team">
	  <view name="team-grid" type="grid"/>
	  <view name="team-form" type="form"/>
	  <view-param name="popup" value="reload"/>
	  <view-param name="show-toolbar" value="false"/>
	  <view-param name="show-confirm" value="true"/>
	  <view-param name="popup-save" value="true"/>
	  <view-param name="forceEdit" value="true"/>
	  <context name="_showRecord" expr="eval: id"/>
	</action-view>
	
	<action-view name="action-project-open-gantt" title="Gantt" model="com.axelor.team.db.TeamTask">
		<view type="gantt" name="task-gantt" />
		<view type="grid" name="team-task-grid" />
		<view type="form" name="team-task-form" />
		<domain>self.project.id = :_id OR self.project.parentProject.id = :_id</domain>
	</action-view>
	
	<action-view name="action-project-book-resource" title="Book resource" model="com.axelor.apps.project.db.ResourceBooking">
		<view type="form" name="resource-booking-form" />
		<view type="grid" name="resource-booking-grid" />
		<view type="calendar" name="resource-booking-calendar" />
		<context name="_project" expr="eval:__self__"/>
	</action-view>

	<action-view name="action-project-add-task" model="com.axelor.team.db.TeamTask" title="Task">
		<view name="team-task-form" type="form"/>
		<view name="team-task-grid" type="grid"/>
		<view-param name="popup" value="reload"/>
		<view-param name="popup-save" value="true"/>
		<view-param name="show-confirm" value="true"/>
		<view-param name="show-toolbar" value="false"/>
		<context name="_project" expr="eval:__self__"/>
	</action-view>

	<action-view name="action-project-open-popup-select-users" title="Select Users" model="com.axelor.apps.base.db.Wizard">
	<view type="form" name="user-select-wizard-form"/>
	 <view-param name="show-toolbar" value="false"/>
	  <view-param name="show-confirm" value="false"/>
	  <view-param name="popup-save" value="false"/>
	</action-view>
	
	<action-view name="action-project-open-popup-select-projects" title="Select Projects" model="com.axelor.apps.base.db.Wizard">
	<view type="form" name="project-select-wizard-form"/>
	 <view-param name="show-toolbar" value="false"/>
	  <view-param name="show-confirm" value="false"/>
	  <view-param name="popup-save" value="false"/>
	</action-view>
	 
	 <action-view name="action-open-project-gantt" title="Project Gantt" model="com.axelor.team.db.TeamTask">
		<view type="gantt" name="project-task-gantt" />
		<view type="grid" name="team-task-grid" />
		<view type="form" name="team-task-form" />
		<domain>self.project.id IN (:_projectIds) OR self.project.parentProject.id IN (:_projectIds)</domain>
		<context name="_projectIds" expr="eval: projectSet.collect{it.id}"/>
	</action-view>
	
	 <action-view name="action-open-user-gantt" title="User Gantt" model="com.axelor.team.db.TeamTask">
		<view type="gantt" name="user-task-gantt" />
		<view type="grid" name="team-task-grid" />
		<view type="form" name="team-task-form" />
		<domain>self.assignedTo.id IN (:_userIds) </domain>
		 <context name="_userIds" expr="eval: userSet.collect{it.id}"/>
	 	</action-view>

    <action-view name="action-project-dashlet-show-purchase-invoice-lines" title="Purchase invoice lines" model="com.axelor.apps.account.db.InvoiceLine">
        <view type="grid" name="invoice-line-grid"/>
        <view type="form" name="invoice-line-form"/>
        <domain>self.invoice.operationTypeSelect = 1 AND self.project.id = :_id</domain>
    </action-view>

    <action-view name="action-project-dashlet-show-sale-invoice-lines" title="Sale invoice lines" model="com.axelor.apps.account.db.InvoiceLine">
        <view type="grid" name="invoice-line-grid"/>
        <view type="form" name="invoice-line-form"/>
        <domain>self.invoice.operationTypeSelect = 3 AND self.project.id = :_id</domain>
    </action-view>
	
	<action-view name="action-project-view-phase" title="Project phase" model="com.axelor.apps.project.db.Project">
		<view type="form" name="project-form"/>
		<view type="grid" name="project-grid"/>
		<view type="calendar" name="project-calendar"/>
		<view type="kanban" name="project-kanban"/>
		<domain>self.isProject = true and self.projectTypeSelect = :_xProjectTypeSelect and self.parentProject.id = :_parentId</domain>
		<context name="_fromProject" expr="eval:true"/>
		<context name="_xProjectTypeSelect" expr="eval: __repo__(Project).TYPE_PHASE"/>
		<context name="_parentId" expr="eval:_id" />
		<context name="_showRecord" expr="eval: id"/>
	</action-view>
	
	<action-view name="action-project-view-phase-new" title="Project phase" model="com.axelor.apps.project.db.Project">
		<view type="form" name="project-form"/>
		<view type="grid" name="project-grid"/>
		<view type="calendar" name="project-calendar"/>
		<view type="kanban" name="project-kanban"/>
		<domain>self.isProject = true and self.projectTypeSelect = :_xProjectTypeSelect and self.parentProject.id = :_parentProjectId</domain>
		<context name="_fromProject" expr="eval:true"/>
		<context name="_xProjectTypeSelect" expr="eval: __repo__(Project).TYPE_PHASE"/>
		<context name="_parentProjectId" expr="eval:id" />
	</action-view>
	
	<action-view name="action-project-view-phase-all" title="Project phases" model="com.axelor.apps.project.db.Project">
		<view type="grid" name="project-grid"/>
		<view type="form" name="project-form"/>
		<view type="calendar" name="project-calendar"/>
		<view type="kanban" name="project-kanban"/>
		<domain>self.isProject = true and self.projectTypeSelect = :_xProjectTypeSelect and self.parentProject.id = :_parentProjectId</domain>
		<context name="_fromProject" expr="eval:true"/>
		<context name="_xProjectTypeSelect" expr="eval: __repo__(Project).TYPE_PHASE"/>
		<context name="_parentProjectId" expr="eval:id" />
	</action-view>
	
	<action-view name="action-project-phase-view-show-phase-task" title="Phase tasks" model="com.axelor.team.db.TeamTask">
		<view type="grid" name="team-task-grid" />
		<view type="form" name="team-task-form" />
		<domain>self.project.parentProject.id = :_projectId</domain>
		<context name="_projectId" expr="eval:id" />
	</action-view>
	 
	<action-record name="action-project-record-compute-exTaxTotal" model="com.axelor.apps.project.db.Project">
		<field name="exTaxTotal" expr="eval: price*qty"/>
	</action-record>
	
	<action-record name="action-project-record-bind-customer-project" model="com.axelor.apps.project.db.Project">
		<field name="clientPartner" expr="eval: project?.clientPartner"/>
	</action-record>
	
	<action-record name="action-project-record-bind-customer-parent" model="com.axelor.apps.project.db.Project">
		<field name="clientPartner" expr="eval: _parent?.clientPartner"/>
	</action-record>
	
	<action-record name="action-project-record-unit" model="com.axelor.apps.project.db.Project">
		<field name="unit" expr="eval: product?.unit"/>
		<field name="price" expr="eval: product?.salePrice"/>
		<field name="qty" expr="1"/>
		<field name="exTaxTotal" expr="eval: product?.salePrice"/>
	</action-record>
	
	<action-method name="action-project-method-set-stored-time-spent" model="com.axelor.apps.project.db.Project">
		<call class="com.axelor.apps.hr.web.project.ProjectController" method="setStoredTimeSpent"/>
	</action-method>
	
	<action-method name="action-project-method-set-stored-lead-delay" model="com.axelor.apps.project.db.Project">
		<call class="com.axelor.apps.hr.web.project.ProjectController" method="setStoredLeadDelay"/>
	</action-method>
	
	<action-method name="action-method-project-compute-progress">
		<call class="com.axelor.apps.businessproject.web.ProjectController" method="computeProgress"/>
	</action-method>
	
	<action-method name="action-method-project-compute-duration-fromchildren">
		<call class="com.axelor.apps.businessproject.web.ProjectController" method="computeDurationFromChildren"/>
	</action-method>
		
	<action-method name="action-project-method-count-to-invoice">
	 	<call class="com.axelor.apps.businessproject.web.ProjectController" method="countToInvoice"/>
     </action-method>
     
     <action-method name="action-project-view-show-invoicing-projects">
		<call class="com.axelor.apps.businessproject.web.ProjectController" method="showInvoicingProjects"/>
	</action-method>
		
  	<action-attrs name="action-project-attrs-scale-and-precision">
		<attribute name="scale" for="price" expr="eval: __config__.app.getNbDecimalDigitForUnitPrice()"/>
	</action-attrs>
	
	<action-attrs name="action-attrs-project-compute-leadDelay" model="com.axelor.apps.project.db.Project">
		<attribute name="value" for="leadDelay" expr="eval: progress.divide(100).multiply(new BigDecimal(duration)).subtract(new BigDecimal(timeSpent))" if="duration"/>
	</action-attrs>
	
	<action-attrs name="action-attrs-domain-on-contact-partner">
		<attribute for="contactPartner" if="clientPartner != null &amp;&amp; !clientPartner.contactPartnerSet.empty" name="domain" expr="eval: &quot;self.id IN (${clientPartner.contactPartnerSet?.collect{it.id}.join(',')})&quot;"/>
 		<attribute for="contactPartner" if="clientPartner != null &amp;&amp; clientPartner.contactPartnerSet.empty" name="domain" expr="eval: &quot;self.id IN (0)&quot;"/>
 		<attribute for="contactPartner" if="clientPartner == null" name="domain" expr="eval: &quot;self.isContact = true&quot;"/>
	</action-attrs>
	
	<action-method name="action-project-method-set-duration">
		<call class="com.axelor.apps.project.web.ProjectController" method="setDuration"/>
	</action-method>

	<action-method name="action-project-method-import-members">
		<call class="com.axelor.apps.project.web.ProjectController" method="importMembers"/>
	</action-method>
	
	<action-record name="action-project-record-status-in-progress" model="com.axelor.apps.project.db.Project">
		<field name="statusSelect" expr="eval: __repo__(Project).STATE_IN_PROGRESS"/>
	</action-record>

	<action-record name="action-project-record-status-finished" model="com.axelor.apps.project.db.Project">
		<field name="statusSelect" expr="eval: __repo__(Project).STATE_FINISHED"/>
	</action-record>

	<action-record name="action-project-record-status-canceled" model="com.axelor.apps.project.db.Project">
		<field name="statusSelect" expr="eval: __repo__(Project).STATE_CANCELED"/>
	</action-record>
	
	 <action-validate name="action-wizard-validate-user-select">
    	<error message="Please select user"  if="eval: userSet == null || userSet  == 0"/>
    </action-validate>
    
     <action-validate name="action-wizard-validate-project-select">
    	<error message="Please select project"  if="eval: projectSet == null || projectSet  == 0"/>
    </action-validate>

    <action-attrs name="action-project-attrs-po-lines-set-domain" model="com.axelor.apps.project.db.Project">
        <attribute for="purchaseOrderLineList" name="domain" expr="eval: &quot;self.project = NULL AND self.invoiced = false&quot;"/>
    </action-attrs>

    <action-attrs name="action-project-attrs-so-lines-set-domain" model="com.axelor.apps.project.db.Project">
        <attribute for="saleOrderLineList" name="domain" expr="eval: &quot;self.project = NULL AND self.amountInvoiced = 0 AND self.saleOrder.clientPartner.id = ${clientPartner?.id} AND self.invoiced = false&quot;"/>
    </action-attrs>

    <action-attrs name="action-project-attrs-expense-lines-set-domain" model="com.axelor.apps.project.db.Project">
        <attribute for="expensesLineList" name="domain" expr="eval: &quot;self.project.id = ${id} AND self.invoiced = false&quot;"/>
    </action-attrs>

    <action-attrs name="action-project-attrs-ro-purchase-order-line-buttons">
        <attribute for="addPurchaseInvoiceLine" name="readonly" expr="eval: invoiceLineList.collect{ (Integer) it.id }.contains((Integer) purchaseInvoiceLine.id)"/>
        <attribute for="remPurchaseInvoiceLine" name="readonly" expr="eval: !invoiceLineList.collect{ (Integer) it.id }.contains((Integer) purchaseInvoiceLine.id)"/>
    </action-attrs>

    <action-attrs name="action-project-attrs-ro-sale-order-line-buttons">
        <attribute for="addSaleInvoiceLine" name="readonly" expr="eval: invoiceLineList.collect{ (Integer) it.id }.contains((Integer) saleInvoiceLine.id)"/>
        <attribute for="remSaleInvoiceLine" name="readonly" expr="eval: !invoiceLineList.collect{ (Integer) it.id }.contains((Integer) saleInvoiceLine.id)"/>
    </action-attrs>

    <action-view name="action-project-view-show-purchase-order-lines" title="PO lines" model="com.axelor.apps.purchase.db.PurchaseOrderLine">
        <view type="grid" name="purchase-order-line-project-grid"/>
        <view type="form" name="purchase-order-line-project-form"/>
        <domain>self.project.id = :_projectId</domain>
        <context name="_projectId" expr="eval: id"/>
    </action-view>

    <action-view name="action-project-view-show-sale-order-lines" title="SO lines" model="com.axelor.apps.sale.db.SaleOrderLine">
        <view type="grid" name="sale-order-line-project-grid"/>
        <view type="form" name="sale-order-line-project-form"/>
        <domain>self.project.id = :_id</domain>
    </action-view>

    <action-view name="action-project-view-show-expense-lines" title="Expense lines" model="com.axelor.apps.hr.db.ExpenseLine">
        <view type="grid" name="expense-line-project-grid"/>
        <view type="form" name="expense-line-project-form"/>
        <domain>self.project.id = :_id</domain>
    </action-view>

    <action-view name="action-project-view-show-purchase-invoice-lines" title="Purchase invoice lines" model="com.axelor.apps.account.db.InvoiceLine">
        <view type="grid" name="invoice-line-grid"/>
        <view type="form" name="invoice-line-form"/>
        <domain>self.invoice.operationTypeSelect = 1 AND self.project.id = :_id</domain>
    </action-view>

    <action-view name="action-project-view-show-sale-invoice-lines" title="Sale invoice lines" model="com.axelor.apps.account.db.InvoiceLine">
        <view type="grid" name="invoice-line-grid"/>
        <view type="form" name="invoice-line-form"/>
        <domain>self.invoice.operationTypeSelect = 3 AND self.project.id = :_id</domain>
    </action-view>

    <action-view name="action-project-view-show-production-orders" title="Production orders" model="com.axelor.apps.production.db.ProductionOrder">
        <view type="grid" name="production-order-grid"/>
        <view type="form" name="production-order-form"/>
        <domain>self.project.id = :_id</domain>
    </action-view>
    
    <action-view name="project.planning" title="Project planning" model="com.axelor.apps.base.db.Wizard">
		<view type="form" name="project-planning-user-select-wizard-form"/>
		<view-param name="show-confirm" value="false"/>
		<view-param name="show-toolbar" value="false"/>
	</action-view>

</object-views>
